<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>çŸ¥è­˜ç‹</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">
<style>
body{font-family:'Noto Sans TC',sans-serif;background:#111;color:#fff;text-align:center}
#q{font-size:36px;margin:20px;animation:fade .5s}
@keyframes fade{from{opacity:0}to{opacity:1}}
.btn{display:block;font-size:28px;margin:10px auto;width:90%}
#timer{height:20px;background:green;margin:10px;transition:width 1s}
#ranking{text-align:left;margin:10px}
#chat{height:120px;overflow:auto;border:1px solid #555;margin:10px}
</style>
</head>
<body>
<h1>ğŸ§  çŸ¥è­˜ç‹</h1>
<input id="name" placeholder="è¼¸å…¥åå­—"><button onclick="join()">åŠ å…¥</button>
<div id="q">ç­‰å¾…ä¸»æŒäººé–‹å§‹</div>
<div id="timer"></div>
<button class="btn" id="A" onclick="answer('A')"></button>
<button class="btn" id="B" onclick="answer('B')"></button>
<button class="btn" id="C" onclick="answer('C')"></button>
<button class="btn" id="D" onclick="answer('D')"></button>
<h3>æ’è¡Œæ¦œ</h3><div id="ranking"></div>
<h3>èŠå¤©å®¤</h3><div id="chat"></div>
<input id="msg"><button onclick="send()">é€å‡º</button>
<audio id="correct" src="sounds/correct.mp3"></audio>
<audio id="wrong" src="sounds/wrong.mp3"></audio>
<audio id="next" src="sounds/next.mp3"></audio>
<script>
let channel=new BroadcastChannel('quiz');
let data=[],idx=-1,ans='',start,my='';
let scores={};
fetch('../questions.csv').then(r=>r.text()).then(t=>{
data=t.trim().split('\n').slice(1).map(r=>r.split(','));
});
function join(){my=name.value.trim();if(!my)return;name.style.display='none';scores[my]=0}
function answer(a){if(!my)return;let s=10-(Date.now()-start)/1000;if(a==ans){correct.play();scores[my]+=Math.max(0,Math.floor(s*10))}else wrong.play();update()}
function update(){ranking.innerHTML=Object.entries(scores).sort((a,b)=>b[1]-a[1]).map(p=>p[0]+': '+p[1]).join('<br>')}
function timerRun(){let t=10;timer.style.width='100%';let i=setInterval(()=>{t--;timer.style.width=t*10+'%';if(t<=0)clearInterval(i)},1000)}
function send(){channel.postMessage({type:'chat',msg:my+': '+msg.value});msg.value=''}
channel.onmessage=e=>{
if(e.data.type=='next'){next.play();idx++;let q=data[idx];ans=q[6];qEl.innerText=q[1];['A','B','C','D'].forEach((k,i)=>document.getElementById(k).innerText=k+'. '+q[i+2]);start=Date.now();timerRun()}
if(e.data.type=='reveal')alert('ç­”æ¡ˆï¼š'+ans)
if(e.data.type=='reset')location.reload()
if(e.data.type=='chat'){chat.innerHTML+=e.data.msg+'<br>'}
}
</script>
</body>
</html>